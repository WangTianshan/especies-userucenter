<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="generator" content="especies.org">
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">
    <link rel="shortcut icon" th:href="@{/images/logo.png}" href="/images/logo.png" type="image/x-icon">
    <meta name="description" content="">
    <title>物种多样性数据平台-用户中心 ESPECIES-USER CENTER</title>
    <!-- 引入css -->
    <th:block th:substituteby="pageFrame/basicsCss :: copy"></th:block>
</head>
<body>
<!-- 引入menu -->
<th:block th:substituteby="pageFrame/basicsMenu :: copy"></th:block>
<section class="engine"><a href="#"></a></section>
<section class="header6 cid-banner especies-fullscreen especies-parallax-background" id="header6-h">
    <div class="especies-overlay" style="opacity: 0.3; background-color: rgb(177, 163, 116);"></div>
    <div class="container">
        <div class="row justify-content-md-center">
            <div class="especies-white col-lg-6 d-none d-sm-block">
                <h3>大标题</h3>
                <p>is a development platform inspired by the way you work. From open source to business, you can host and review code, manage projects, and build software alongside 31 million developers. </p>
            </div>
            <div th:if="${#lists.isEmpty(session.SPRING_SECURITY_CONTEXT)}" id="accordion" class="especies-white col-md-12 col-lg-6">
                <div class="card card-black">
                    <div class="card-header" id="headingOne">
                        <h5 class="mb-0">
                            <button th:text="#{forms_sign_in}" class="btn btn-outline-light" data-toggle="collapse" data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                                登陆
                            </button>
                        </h5>
                    </div>
                    <div id="collapseOne" aria-labelledby="headingOne" data-parent="#accordion"
                            th:class="${signType eq 'signIn'}?
                            'collapse show':
                            'collapse'"
                    >
                    <!--<div id="collapseOne" class="collapse show" aria-labelledby="headingOne" data-parent="#accordion">-->
                        <div class="card-body">
                            <form id="sign-in-form" th:action="@{/login}" action="login" method="post" th:object="${newUser}" onkeydown="if(event.keyCode==13) return signIn();">
                                <div class="form-row">
                                    <div class="form-group col-md-6">
                                        <label for="sign-in-key" th:text="#{forms_sign_in_key}">注册邮箱或手机</label>
                                        <input type="text" class="form-control" th:field="*{username}" id="sign-in-key" th:placeholder="#{forms_sign_in_key_placeholder}" placeholder="请输入注册邮箱地址或注册手机号">
                                        <!--<small id="emailHelp" class="form-text text-muted">We'll never share your email with anyone else.</small>-->
                                    </div>
                                    <div class="form-group col-md-6">
                                        <label for="sign-in-password" th:text="#{forms_sign_in_password}">Password</label>
                                        <input type="password" class="form-control" name="password" id="sign-in-password" th:placeholder="#{forms_sign_in_password_placeholder}" placeholder="请输入密码">
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group col-md-6">
                                        <label for="sign-in-token" th:text="#{forms_sign_in_token}">Token</label>
                                        <div class="input-group">
                                            <a class="input-group-prepend" onclick="reImg()">
                                                <div class="input-group-text form-code-img">
                                                    <img style="height:32px;" class="codeImg" th:src="@{/captchaImg}" th:title="#{forms_change_token}"/>
                                                </div>
                                            </a>
                                            <input type="text" class="form-control" name="token" id="sign-in-token" th:placeholder="#{forms_sign_in_token_placeholder}" placeholder="请输入验证码">
                                        </div>
                                    </div>
                                </div>
                                <div th:if="${resultType eq 'signUpSuccess'}" class="alert alert-success" role="alert">
                                    <h4 class="alert-heading">Well done!</h4>
                                    <p>Aww yeah, you successfully read this important alert message. This example text is going to run a bit longer so that you can see how spacing within an alert works with this kind of content.</p>
                                    <hr>
                                    <p class="mb-0">Whenever you need to, be sure to use margin utilities to keep things nice and tidy.</p>
                                </div>
                                <div id="sign-in-alert"></div>
                                <!--<button type="submit" class="btn btn-success" th:text="#{forms_sign_in_submit}">Submit</button>-->
                                <button type="button" class="btn btn-success" th:text="#{forms_sign_in_submit}" onclick="signIn();">Submit</button>
                            </form>
                        </div>
                    </div>
                    <div class="card-header" id="headingTwo">
                        <h5 class="mb-0">
                            <button th:text="#{forms_sign_up}" class="btn btn-outline-light collapsed" data-toggle="collapse" data-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                                注册
                            </button>
                        </h5>
                    </div>
                    <div id="collapseTwo" aria-labelledby="headingTwo" data-parent="#accordion"
                         th:class="${signType eq 'signUp'}?
                            'collapse show':
                            'collapse'"
                    >
                    <!--<div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-parent="#accordion">-->
                        <div class="card-body">
                            <form id="sign-up-form" th:action="@{/register/new}" action="register/new" method="post" th:object="${newUser}">
                                <div class="form-row">
                                    <div class="form-group col-md-6">
                                        <label for="sign-up-username" th:text="#{forms_sign_up_username}">用户名</label>
                                        <input type="text" class="form-control" th:field="*{username}" id="sign-up-username" th:placeholder="#{forms_sign_up_username_placeholder}" placeholder="请输入用户名">
                                    </div>
                                    <div class="form-group col-md-6">
                                        <label for="sign-up-email" th:text="#{forms_sign_up_email}">Email</label>
                                        <input type="email" class="form-control" th:field="*{email}" id="sign-up-email" th:placeholder="#{forms_sign_up_email_placeholder}" placeholder="请输入注册邮箱地址">
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group col-md-6">
                                        <label for="sign-up-password" th:text="#{forms_sign_up_password}">Password</label>
                                        <input type="password" class="form-control" th:field="*{pwd}" id="sign-up-password" th:placeholder="#{forms_sign_up_password_placeholder}" placeholder="请输入密码">
                                    </div>
                                    <div class="form-group col-md-6">
                                        <label for="sign-up-repassword" th:text="#{forms_sign_up_repassword}">RePassword</label>
                                        <input type="password" class="form-control" id="sign-up-repassword" th:placeholder="#{forms_sign_up_repassword_placeholder}" placeholder="请再次输入密码">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="termsCheck">
                                        <label class="form-check-label" for="termsCheck">
                                            <span th:text="#{forms_sign_up_agree}">I agree to the</span>
                                            <a href="#" data-toggle="modal" data-target="#modal-terms" th:text="#{forms_sign_up_terms}">terms</a>
                                            <!--<button type="button" class="btn btn-link" data-toggle="modal" data-target="#modal-terms" th:text="#{forms_sign_up_terms}">-->
                                                <!--terms-->
                                            <!--</button>-->
                                        </label>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group col-md-6">
                                        <label for="sign-in-token" th:text="#{forms_sign_in_token}">Token</label>
                                        <div class="input-group">
                                            <a class="input-group-prepend" onclick="reImg()">
                                                <div class="input-group-text form-code-img">
                                                    <img style="height:32px;" class="codeImg" th:src="@{/captchaImg}" th:title="#{forms_change_token}"/>
                                                </div>
                                            </a>
                                            <input type="text" class="form-control" name="token" id="sign-up-token" th:placeholder="#{forms_sign_in_token_placeholder}" placeholder="请输入验证码">
                                        </div>
                                    </div>
                                </div>

                                <div th:if="${resultType eq 'signUpError'}" class="alert alert-danger alert-outline-danger alert-dismissible fade show" role="alert">
                                    <strong th:text="#{alert_warning}+'：'">提示：</strong>
                                    <p th:text="${errorMessage}"></p>
                                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>

                                <button type="submit" class="btn btn-success" th:text="#{forms_sign_up}">Sign up</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <div th:if="${not #lists.isEmpty(session.SPRING_SECURITY_CONTEXT)}" id="userin" class="especies-white col-md-12 col-lg-6">
                <div class="alert alert-dark card-black" role="alert">
                    <p></p>
                    <img th:if="${#lists.isEmpty(session.SPRING_SECURITY_CONTEXT.getAuthentication().getPrincipal().getProfilePicture())}" th:src="@{/img/user-none-160x160.jpg}"
                         class="col-sm-4 rounded-circle float-left" alt="User Image">
                    <img th:if="${not #lists.isEmpty(session.SPRING_SECURITY_CONTEXT.getAuthentication().getPrincipal().getProfilePicture())}" th:src="${session.SPRING_SECURITY_CONTEXT.getAuthentication().getPrincipal().getProfilePicture()}"
                         class="col-sm-4 rounded-circle float-left" alt="User Image">
                    <p></p>
                    <h4 class="alert-heading" th:text="${session.SPRING_SECURITY_CONTEXT.getAuthentication().getPrincipal().getUsername()}">Name</h4>
                    <hr>
                    <p>
                        <dl class="row">
                            <dt th:if="${not #lists.isEmpty(session.SPRING_SECURITY_CONTEXT.getAuthentication().getPrincipal().getEmail())}" th:text="#{forms_email}+'：'" class="col-sm-5">邮箱：</dt>
                            <dd th:if="${not #lists.isEmpty(session.SPRING_SECURITY_CONTEXT.getAuthentication().getPrincipal().getEmail())}" class="col-sm-7" th:text="${session.SPRING_SECURITY_CONTEXT.getAuthentication().getPrincipal().getEmail()}"></dd>

                            <dt th:if="${not #lists.isEmpty(session.SPRING_SECURITY_CONTEXT.getAuthentication().getPrincipal().getMobile())}" th:text="#{forms_mobile}+'：'" class="col-sm-5">手机：</dt>
                            <dd th:if="${not #lists.isEmpty(session.SPRING_SECURITY_CONTEXT.getAuthentication().getPrincipal().getMobile())}" class="col-sm-7" th:text="${session.SPRING_SECURITY_CONTEXT.getAuthentication().getPrincipal().getMobile()}"></dd>

                            <dt th:if="${not #lists.isEmpty(session.SPRING_SECURITY_CONTEXT.getAuthentication().getPrincipal().getNickname())}" th:text="#{forms_nickname}+'：'" class="col-sm-5">昵称：</dt>
                            <dd th:if="${not #lists.isEmpty(session.SPRING_SECURITY_CONTEXT.getAuthentication().getPrincipal().getNickname())}" class="col-sm-7" th:text="${session.SPRING_SECURITY_CONTEXT.getAuthentication().getPrincipal().getNickname()}"></dd>

                            <dt th:if="${not #lists.isEmpty(session.SPRING_SECURITY_CONTEXT.getAuthentication().getPrincipal().getRealName())}" th:text="#{forms_real_name}+'：'" class="col-sm-5">姓名：</dt>
                            <dd th:if="${not #lists.isEmpty(session.SPRING_SECURITY_CONTEXT.getAuthentication().getPrincipal().getRealName())}" class="col-sm-7" th:text="${session.SPRING_SECURITY_CONTEXT.getAuthentication().getPrincipal().getRealName()}"></dd>

                            <dt th:if="${not #lists.isEmpty(session.SPRING_SECURITY_CONTEXT.getAuthentication().getPrincipal().getSignUpTime())}" th:text="#{forms_sign_up_time}+'：'" class="col-sm-5">注册时间：</dt>
                            <dd th:if="${not #lists.isEmpty(session.SPRING_SECURITY_CONTEXT.getAuthentication().getPrincipal().getSignUpTime())}" class="col-sm-7" th:text="${#dates.format(session.SPRING_SECURITY_CONTEXT.getAuthentication().getPrincipal().getSignUpTime(), 'yyyy-MM-dd hh:mm:ss')}"></dd>

                            <dt th:if="${not #lists.isEmpty(session.SPRING_SECURITY_CONTEXT.getAuthentication().getPrincipal().getLastSignInTime())}" th:text="#{forms_last_sign_in_time}+'：'" class="col-sm-5">最后登陆：</dt>
                            <dd th:if="${not #lists.isEmpty(session.SPRING_SECURITY_CONTEXT.getAuthentication().getPrincipal().getLastSignInTime())}" class="col-sm-7" th:text="${#dates.format(session.SPRING_SECURITY_CONTEXT.getAuthentication().getPrincipal().getLastSignInTime(), 'yyyy-MM-dd hh:mm:ss')}"></dd>
                        </dl>
                    </p>
                    <hr>
                    <p class="mb-0">Whenever you need to, be sure to use margin utilities to keep things nice and tidy.</p>
                    <hr>
                    <a href="#" class="btn btn-outline-light" th:text="#{forms_personal_center}">个人中心</a>
                    <a href="#" data-toggle="modal" data-target="#modal-sign-out" class="btn btn-outline-secondary float-right" th:text="#{forms_sign_out}">注销</a>
                </div>
            </div>
        </div>
    </div>
    </div>
</section>

<!-- 协议 -->
<div th:if="${#lists.isEmpty(session.SPRING_SECURITY_CONTEXT)}" class="modal fade" id="modal-terms" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modal-terms-title" th:text="#{forms_sign_up_terms}">terms</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p><b>1、关于Especies</b></p>
                <p>&nbsp;&nbsp;&nbsp;&nbsp;目的是通过公民科学积累物种相关数据，支持生物多样性研究。<br/>
                    &nbsp;&nbsp;&nbsp;&nbsp;NOL提供数据管理、共享及交流平台，不进行数据交易。数据用户可以联系数据提供者获取质量更高的数据。</p>
                <p><b>2、数据共享</b></p>
                <p>&nbsp;&nbsp;&nbsp;&nbsp;所有多媒体数据根据CC协议进行共享标注，数据提供者在上传数据时都要指定自己数据的共享方式。<br/>
                    &nbsp;&nbsp;&nbsp;&nbsp;数据用户必须遵守数据共享政策，违反数据共享政策者，一旦发现将依法追究其侵犯版权的行为。</p>
                <p><b>3、数据所有权人权利</b></p>
                <p>&nbsp;&nbsp;&nbsp;&nbsp;数据版权归数据所有权人所有，数据上传者必须上传自己拥有版权的数据，如果自己不拥有版权，必须符合原始数据的CC共享协议。</p>
                <p><b>4、用户权利及义务：</b></p>
                <p>&nbsp;&nbsp;&nbsp;&nbsp;所有用户在Especies网站或APP提交的数据必须跟生物物种相关，无关的数据将被管理员删除。所有用户必须遵守国家相关法律规定，不得传播违反法律禁止的内容。</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default pull-left" data-dismiss="modal" th:text="#{forms_cancel}">取消</button>
                <button type="button" class="btn btn-success" th:text="#{forms_sign_up_i_agree}" onclick="agreeTerms();">I agree</button>
            </div>
        </div>
    </div>
</div>
<!-- 注销 -->
<div th:if="${not #lists.isEmpty(session.SPRING_SECURITY_CONTEXT)}" id="modal-sign-out" class="modal fade bs-example-modal-sm" tabindex="-1" role="dialog" aria-labelledby="modal-sign-out">
    <div class="modal-dialog modal-sm" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" th:text="#{forms_sign_out}">注销</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" th:text="#{forms_sign_out_confirm}">
                是否注销当前用户？
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default float-left" data-dismiss="modal" th:text="#{forms_cancel}">取消</button>
                <a th:href="@{/logout}" class="btn btn-dark" th:text="#{forms_sign_out}">注销</a>
            </div>
        </div>
    </div>
</div>
<!-- 引入footer -->
<th:block th:substituteby="pageFrame/basicsFooter :: copy"></th:block>
<!-- 引入js【body末尾引入js文件会使页面加载更快】 -->
<th:block th:substituteby="pageFrame/basicsJs :: copy"></th:block>
<!-- jquery.tmpl -->
<script th:src="@{/plugins/jquery.tmpl/jquery.tmpl.min.js}"></script>

<!-- page_script -->
<script>
    function reImg(){
        var img = $(".codeImg")
        img.src = "captchaImg";
        $(".codeImg").attr("src", 'captchaImg?code='+Math.random());
    }
</script>
<!-- 构造引证 -->
<script id="tmpl-sign-in-error" type="text/x-jquery-tmpl">
    <div id="sign-in-alert-error" class="alert alert-danger alert-outline-danger alert-dismissible fade show" role="alert" style="display:none;">
        <strong>{{= title}}：</strong>
        <p>{{= result}}</p>
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
</script>
<script>
    function signIn() {
        var options = {url:'login',type:'post',cache:false,dataType:'json',
            success:function(data){
                if(data.result=='Login Success' || data.result=='登录成功'){
                    $.ajax({url:"user/rest/updata/signInTime",async:true});
                    layer.msg(data.result,
                        {
                            time: 500, //1.5s后自动关闭
                        },
                        function(){
                           window.location.reload();//刷新当前页面.
                        });
                }
                else{
                    showSignInError(data);
                }
            },
            error:function(){
                layer.msg("页面会话时间过长，自动刷新后请重新登录",
                    {
                        time: 1500, //1.5s后自动关闭
                    },
                    function(){
                        window.location.reload();//刷新当前页面.
                    });
            }
        }
        $("#sign-in-form").ajaxSubmit(options);
        return false;
    }
    //显示登陆错误提示
    function showSignInError(message) {
        $("#sign-in-alert-error").remove();
        $("#tmpl-sign-in-error").tmpl(message).appendTo("#sign-in-alert").ready(function () {
            $('#sign-in-alert-error').fadeIn();
        });
    }

</script>
</body>
</html>
